var Se=Object.create;var k=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames;var ke=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var De=(e,o)=>{for(var s in o)k(e,s,{get:o[s],enumerable:!0})},F=(e,o,s,r)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of Pe(o))!je.call(e,a)&&a!==s&&k(e,a,{get:()=>o[a],enumerable:!(r=we(o,a))||r.enumerable});return e};var R=(e,o,s)=>(s=e!=null?Se(ke(e)):{},F(o||!e||!e.__esModule?k(s,"default",{value:e,enumerable:!0}):s,e)),Me=e=>F(k({},"__esModule",{value:!0}),e);var Be={};De(Be,{default:()=>Fe});module.exports=Me(Be);var he=require("@mischnic/json-sourcemap"),ye=require("@parcel/plugin"),xe=require("@parcel/utils");var O=typeof globalThis.process<"u"?globalThis.process.argv:[];var N=()=>typeof globalThis.process<"u"?globalThis.process.env:{},Le=/\$([\w+]+)/gm,B=(e,o=N(),s=Le)=>e.replace(s,(r,a)=>o[a]||r);var Ee=new Set(O),U=e=>Ee.has(e),Je=O.filter(e=>e.startsWith("--")&&e.includes("=")).map(e=>e.split("=")).reduce((e,[o,s])=>(e[o]=s,e),{});var ze=U("--dry-run"),V=()=>U("--verbose")||N().VERBOSE==="true",Xe=V();var I=(e="",...o)=>console.log(e.padEnd(9),"|",...o);var j=(...e)=>I("\u{1F7E0} WARN",...e),Re=0,b=(...e)=>V()&&I(`\u{1F7E1} ${Re++}`,...e);var H=require("@parcel/diagnostic");var v=require("path"),Oe=(e,o,s,r)=>{let a={extraAssets:[],program:o,hmrOptions:r.hmrOptions,hot:Boolean(r.hmrOptions),fs:e.fs,filePath:e.filePath,ptrs:s,asset:e,env:r.env,_isMV2:o.manifest_version===2},i=(0,v.dirname)(e.filePath),n=(0,v.resolve)(i,".."),c=(0,v.resolve)(n,"assets");return{...a,srcDir:process.env.PLASMO_SRC_DIR,dotPlasmoDir:i,projectDir:n,assetsDir:c,getAssets:()=>[...a.extraAssets,e]}},A={},l=()=>A,C=async(...e)=>{A=Oe(...e)},D=e=>A._isMV2;async function W(){let{program:e,filePath:o,ptrs:s,asset:r}=l(),a=D(e),i=a?"browser_action":"action",n=a?e.browser_action:e.action;!n||n.theme_icons&&(n.theme_icons=n.theme_icons.map((c,d)=>{for(let u of["light","dark"]){let m=(0,H.getJSONSourceLocation)(s[`/${i}/theme_icons/${d}/${u}`],"value");c[u]=r.addURLDependency(c[u],{loc:{...m,filePath:o}})}return c}))}var $=require("@parcel/diagnostic");var z=R(require("content-security-policy-parser")),J="'unsafe-eval'";function M(e,o=J){let s=o===J?"'self' blob: filesystem:":"'self'";if(e){let r=(0,z.default)(e);e="",r["script-src"]||(r["script-src"]=[s]),r["script-src"].includes(o)||r["script-src"].push(o),r.sandbox&&!r.sandbox.includes("allow-scripts")&&r.sandbox.push("allow-scripts");for(let a in r)e+=`${a} ${r[a].join(" ")};`;return e}else return`script-src ${s} ${o};object-src ${s};`}var X=()=>{let{program:e}=l();D(e)?Ne(e):Ve(e)},K="../runtime/plasmo-default-background.ts";function Ne(e){let{hot:o,asset:s,filePath:r,ptrs:a}=l();b("Handling background scripts"),e.background?.page&&(e.background.page=s.addURLDependency(e.background.page,{bundleBehavior:"isolated",loc:{filePath:r,...(0,$.getJSONSourceLocation)(a["/background/page"],"value")}})),e.background?.scripts&&(e.background.scripts=e.background.scripts.map(i=>s.addURLDependency(i,{bundleBehavior:"isolated"}))),o&&(e.content_security_policy=M(e.content_security_policy),e.background||(e.background={}),e.background?.scripts||(e.background.scripts=[]),e.background.scripts.push(s.addURLDependency(K,{resolveFrom:__filename})))}function Ve(e){let{hot:o,asset:s,filePath:r,ptrs:a,hmrOptions:i}=l();if(b("Handling background service worker"),e.background?.service_worker&&(e.background.service_worker=s.addURLDependency(e.background.service_worker,{bundleBehavior:"isolated",loc:{filePath:r,...(0,$.getJSONSourceLocation)(a["/background/service_worker"],"value")},env:{context:"service-worker"}}),e.background.type&&delete e.background.type),o){let n=e.content_security_policy||{};n.extension_pages=M(n.extension_pages,`http://${i?.host||"localhost"}`),n.sandbox&&(n.sandbox=M(n.sandbox)),e.content_security_policy=n,e.background||(e.background={service_worker:s.addURLDependency(K,{resolveFrom:__filename,env:{context:"service-worker"}})})}}var G=require("@parcel/diagnostic");function Q(){let{program:e,asset:o,filePath:s,ptrs:r}=l();if(!!e.content_scripts)for(let a=0;a<e.content_scripts.length;++a){let i=e.content_scripts[a];for(let n of["css","js"]){let c=i[n]||[];for(let d=0;d<c.length;++d)c[d]=o.addURLDependency(c[d],{bundleBehavior:"isolated",loc:{filePath:s,...(0,G.getJSONSourceLocation)(r[`/content_scripts/${a}/${n}/${d}`],"value")}})}}}var Y=require("@parcel/diagnostic");async function Z(){let{program:e,filePath:o,ptrs:s,asset:r}=l();if(!e.declarative_net_request)return;let a=e.declarative_net_request.rule_resources;!a||(e.declarative_net_request.rule_resources=a.map((i,n)=>(i.path=r.addURLDependency(i.path,{pipeline:"raw-env",loc:{filePath:o,...(0,Y.getJSONSourceLocation)(s[`/declarative_net_request/rule_resources/${n}/path`],"value")}}),i)))}var T=require("@parcel/diagnostic"),q=require("path");var Ae=[["icons"],["browser_action","default_icon"],["browser_action","default_popup"],["page_action","default_icon"],["page_action","default_popup"],["action","default_icon"],["action","default_popup"],["chrome_url_overrides"],["devtools_page"],["options_ui","page"],["sidebar_action","default_icon"],["sidebar_action","default_panel"],["storage","managed_schema"],["theme","images","theme_frame"],["theme","images","additional_backgrounds"],["user_scripts","api_script"]],ee=()=>{let{program:e,filePath:o,ptrs:s,asset:r}=l(),a=Ae.map(i=>[i,"/"+i.join("/")]).filter(([i,n])=>!!s[n]);for(let[i,n]of a){let c=i.length-1,d=i[c],u=i.reduce((f,h,g)=>g===c?f:f[h],e),m=u[d];if(b(`Adding ${d}`),typeof m=="string"){let f=(0,q.extname)(m);u[d]=r.addURLDependency(m,{bundleBehavior:"isolated",loc:{filePath:o,...(0,T.getJSONSourceLocation)(s[n],"value")},needsStableName:f===".html",pipeline:f===".json"?"raw-env":void 0})}else for(let f of Object.keys(m)){let h=(0,q.extname)(m[f]);m[f]=r.addURLDependency(m[f],{bundleBehavior:"isolated",loc:{filePath:o,...(0,T.getJSONSourceLocation)(s[n+"/"+f],"value")},needsStableName:h===".html",pipeline:h===".json"?"raw-env":void 0})}}};var L=R(require("@parcel/diagnostic")),te=R(require("path"));function oe(){let{program:e,ptrs:o,filePath:s,asset:r}=l();if(!!e.dictionaries)for(let a in e.dictionaries){let i=(0,L.getJSONSourceLocation)(o[`/dictionaries/${a}`],"value"),n={filePath:s,...i},c=e.dictionaries[a];if(te.default.extname(c)!==".dic")throw new L.default({diagnostic:[{message:"Invalid Web Extension manifest",origin:"@plasmohq/parcel-transformer-manifest",codeFrames:[{filePath:s,codeHighlights:[{...i,message:"Dictionaries must be .dic files"}]}]}]});e.dictionaries[a]=r.addURLDependency(c,{needsStableName:!0,loc:n}),r.addURLDependency(c.slice(0,-4)+".aff",{needsStableName:!0,loc:n})}}var y=require("path");var se=async(e,o,s="json",r=[])=>{let{asset:a,fs:i,extraAssets:n}=l(),c=await i.readFile(e,"utf8"),d=B(c);n.push({type:s,uniqueKey:o,content:d,bundleBehavior:"isolated",isBundleSplittable:s!=="json",env:a.env,dependencies:r,meta:{bundlePath:o,webextEntry:!1}})},re=e=>{process.env.__PLASMO_FRAMEWORK_INTERNAL_WATCHER_STARTED||j(e)};async function ae(){let{program:e,asset:o,assetsDir:s,projectDir:r}=l(),a=[(0,y.resolve)(r,"locales"),(0,y.resolve)(s,"locales"),(0,y.resolve)(s,"_locales")].find(c=>o.fs.existsSync(c));if(!a)return;let i=await o.fs.readdir(a);if(i.length===0){b("No locale found, skipping");return}if(e.default_locale||(e.default_locale=i[0],re(`default_locale not set, fallback to ${i[0]}`)),!await o.fs.exists((0,y.resolve)(a,e.default_locale,"messages.json"))){j("Default locale message.json not found, skipping locale!"),delete e.default_locale;return}await Promise.all(i.map(async c=>{b(`Adding locale ${c}`);let d=(0,y.resolve)(a,c,"messages.json");if(await o.fs.exists(d)){let u=`_locales/${c}/messages.json`;o.invalidateOnFileChange(d),await se(d,u)}}))}var S=require("path");async function ie(){let{asset:e,srcDir:o,dotPlasmoDir:s,program:r}=l(),a=["sandboxes","sandbox.ts","sandbox.tsx"].map(g=>(0,S.resolve)(o,g)),i=(0,S.resolve)(s,"sandboxes"),[n,c,d,u]=await Promise.all([...a,i].map(g=>e.fs.exists(g))),[m]=a,f=[];if(n&&u){let g=await e.fs.readdir(m);g.length>0&&g.forEach(x=>{let P=x.split(".");P.pop(),f.push([x,`${P.join(".")}.html`])})}let h=c||d;!h&&f.length===0||(r.sandbox||(r.sandbox={}),r.sandbox.pages||(r.sandbox.pages=[]),h&&r.sandbox.pages.push(e.addURLDependency("sandbox.html",{needsStableName:!0})),await Promise.all(f.map(async([g,x])=>{let P=(0,S.resolve)(m,g),ve=(0,S.resolve)(i,x);await e.fs.exists(P)&&await e.fs.exists(ve)&&(b(`Adding sandbox page: ${g}`),r.sandbox.pages.push(e.addURLDependency(`sandboxes/${x}`,{needsStableName:!0})))})))}var w=require("path");async function ne(){let{asset:e,dotPlasmoDir:o,srcDir:s}=l(),r=(0,w.resolve)(s,"tabs"),a=(0,w.resolve)(o,"tabs"),[i,n]=await Promise.all([e.fs.exists(a),e.fs.exists(r)]);if(!i||!n)return;let c=await e.fs.readdir(r);if(c.length===0){b(`No tab found in ${r}, skipping`);return}let d=c.map(u=>{let m=u.split(".");return m.pop(),[u,`${m.join(".")}.html`]});await Promise.all(d.map(async([u,m])=>{let f=(0,w.resolve)(a,m),h=(0,w.resolve)(r,u);await e.fs.exists(f)&&await e.fs.exists(h)&&(b(`Adding tab ${u}`),e.addURLDependency(`./tabs/${m}`,{bundleBehavior:"isolated",needsStableName:!0}))}))}var ce=()=>{let{program:e}=l();delete e.$schema};var $e=e=>e.some(o=>{let s=Number(o);return!isNaN(s)&&s<0&&s>65536}),pe=(e,o=3,s="Browser")=>{let r=e.split(".");if(r.length>o)return`${s} versions to have at most ${o} dots`;if($e(r))return`${s} versions must be dot-separated integers between ${0} and ${65535}`},le=e=>pe(e,3,"Semantic"),de=e=>pe(e,4,"Browser");var t={type:"string"},_={type:"boolean"},ue={type:"object",properties:{},additionalProperties:t},E={browser_style:_,default_icon:{oneOf:[ue,t]},default_popup:t,default_title:t},p={type:"array",items:t},fe={type:"object",properties:{...E,default_area:{type:"string",enum:["navbar","menupanel","tabstrip","personaltoolbar"]},theme_icons:{type:"array",items:{type:"object",properties:{light:t,dark:t,size:{type:"number"}},additionalProperties:!1,required:["light","dark","size"]}}},additionalProperties:!1},me={type:"object",properties:{resources:p,matches:p,extension_ids:p,use_dynamic_url:_},additionalProperties:!1},_e={$schema:t,name:t,version:{type:"string",__validate:le},default_locale:t,description:t,icons:ue,author:t,browser_specific_settings:{type:"object",properties:{},additionalProperties:{type:"object",properties:{}}},chrome_settings_overrides:{type:"object",properties:{homepage:t,search_provider:{type:"object",properties:{name:t,keyword:t,favicon_url:t,search_url:t,encoding:t,suggest_url:t,image_url:t,instant_url:t,search_url_post_params:t,suggest_url_post_params:t,image_url_post_params:t,instant_url_post_params:t,alternate_urls:p,prepopulated_id:{type:"number"},is_default:_},additionalProperties:!1,required:["name","search_url"]},startup_pages:p},additionalProperties:!1},chrome_url_overrides:{type:"object",properties:{bookmarks:t,history:t,newtab:t},additionalProperties:!1},commands:{type:"object",properties:{},additionalProperties:{type:"object",properties:{suggested_key:{type:"object",properties:{default:t,mac:t,linux:t,windows:t,chromeos:t,android:t,ios:t},additionalProperties:!1},description:t},additionalProperties:!1}},content_scripts:{type:"array",items:{type:"object",properties:{matches:p,css:p,js:p,match_about_blank:_,exclude_matches:p,include_globs:p,exclude_globs:p,run_at:{type:"string",enum:["document_idle","document_start","document_end"]},all_frames:_},additionalProperties:!1,required:["matches"]}},declarative_net_request:{type:"object",properties:{rule_resources:{type:"array",items:{type:"object",properties:{id:t,enabled:_,path:t},additionalProperties:!1,required:["id","enabled","path"]}}},additionalProperties:!1,required:["rule_resources"]},devtools_page:t,dictionaries:{type:"object",properties:{},additionalProperties:t},externally_connectable:{type:"object",properties:{ids:p,matches:p,accept_tls_channel_id:_},additionalProperties:!1},file_browser_handlers:{type:"array",items:{type:"object",properties:{id:t,default_title:t,file_filters:p},additionalProperties:!1,required:["id","default_title","file_filters"]}},file_system_provider_capabilities:{type:"object",properties:{configurable:_,multiple_mounts:_,watchable:_,source:{type:"string",enum:["file","device","network"]}},additionalProperties:!1,required:["source"]},homepage_url:t,incognito:{type:"string",enum:["spanning","split","not_allowed"]},key:t,minimum_chrome_version:{type:"string",__validate:de},oauth2:{type:"object",properties:{client_id:t,scopes:p},additionalProperties:!1},offline_enabled:_,omnibox:{type:"object",properties:{},additionalProperties:t},optional_host_permissions:p,optional_permissions:p,options_ui:{type:"object",properties:{browser_style:_,open_in_tab:_,page:t},additionalProperties:!1,required:["page"]},permissions:p,protocol_handlers:{type:"array",items:{type:"object",properties:{protocol:t,name:t,uriTemplate:t},additionalProperties:!1,required:["protocol","name","uriTemplate"]}},requirements:{type:"object",properties:{"3D":{type:"object",properties:{features:p},additionalProperties:!1}}},short_name:t,sidebar_action:{type:"object",properties:{browser_style:E.browser_style,default_icon:E.default_icon,default_panel:t,default_title:t,open_at_install:_},additionalProperties:!1,required:["default_panel"]},storage:{type:"object",properties:{managed_schema:t},additionalProperties:!1},theme:{type:"object",properties:{images:{type:"object",properties:{theme_frame:t,additional_backgrounds:p},additionalProperties:!1},colors:{type:"object",properties:{bookmark_text:t,button_background_active:t,button_background_hover:t,icons:t,icons_attention:t,frame:t,frame_inactive:t,ntp_background:t,ntp_text:t,popup:t,popup_border:t,popup_highlight:t,popup_highlight_text:t,popup_text:t,sidebar:t,sidebar_border:t,sidebar_highlight:t,sidebar_highlight_text:t,sidebar_text:t,tab_background_separator:t,tab_background_text:t,tab_line:t,tab_loading:t,tab_selected:t,tab_text:t,toolbar:t,toolbar_bottom_separator:t,toolbar_field:t,toolbar_field_border:t,toolbar_field_border_focus:t,toolbar_field_focus:t,toolbar_field_highlight:t,toolbar_field_highlight_text:t,toolbar_field_separator:t,toolbar_field_text:t,toolbar_field_text_focus:t,toolbar_text:t,toolbar_top_separator:t,toolbar_vertical_separator:t},additionalProperties:!1},properties:{type:"object",properties:{additional_backgrounds_alignment:p,additional_backgrounds_tiling:{type:"array",items:{type:"string",enum:["no-repeat","repeat","repeat-x","repeat-y"]}}},additionalProperties:!1}},additionalProperties:!1,required:["colors"]},tts_engine:{type:"object",properties:{voices:{type:"array",items:{type:"object",properties:{voice_name:t,lang:t,event_type:{type:"string",enum:["start","word","sentence","marker","end","error"]}},additionalProperties:!1,required:["voice_name","event_type"]}}},additionalProperties:!1},update_url:t,user_scripts:{type:"object",properties:{api_script:t},additionalProperties:!1},version_name:t},be={type:"object",properties:{..._e,manifest_version:{type:"number",enum:[3]},action:fe,background:{type:"object",properties:{service_worker:t,type:{type:"string",enum:["classic","module"]}},additionalProperties:!1,required:["service_worker"]},content_security_policy:{type:"object",properties:{extension_pages:t,sandbox:t},additionalProperties:!1},host_permissions:p,sandbox:{type:"object",properties:{pages:p},additionalProperties:!1},web_accessible_resources:{type:"array",items:{oneOf:[{...me,required:["resources","matches"]},{...me,required:["resources","extension_ids"]}]}}},required:["manifest_version","name","version"]},ge={type:"object",properties:{..._e,manifest_version:{type:"number",enum:[2]},background:{type:"object",properties:{scripts:p,page:t,persistent:_},additionalProperties:!1},browser_action:fe,content_security_policy:t,page_action:{type:"object",properties:{...E,hide_matches:p,show_matches:p,pinned:_},additionalProperties:!1},sandbox:{type:"object",properties:{pages:p,content_security_policy:t},additionalProperties:!1},web_accessible_resources:p},required:["manifest_version","name","version"]};async function Te(){ce(),await Promise.all([ne(),ie(),ae(),W(),Z()]),Q(),oe(),ee(),X()}var qe=()=>{switch(process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS){case"inline":return{inline:!0,inlineSources:!0};case"external":return{inline:!1,inlineSources:!1};default:return}},Fe=new ye.Transformer({async transform({asset:e,options:o}){b("@plasmohq/parcel-transformer-manifest"),e.setEnvironment({context:"browser",outputFormat:e.env.outputFormat==="commonjs"?"global":e.env.outputFormat,engines:{browsers:e.env.engines.browsers},sourceMap:e.env.sourceMap&&qe(),includeNodeModules:e.env.includeNodeModules,sourceType:e.env.sourceType,isLibrary:e.env.isLibrary,shouldOptimize:e.env.shouldOptimize,shouldScopeHoist:e.env.shouldScopeHoist});let s=await e.getCode(),r=(0,he.parse)(s),a=r.data,i=a.manifest_version===3?be:ge;xe.validateSchema.diagnostic(i,{data:a,source:s,filePath:e.filePath},"@plasmohq/parcel-transformer-manifest","Invalid Web Extension manifest"),await C(e,a,r.pointers,o);let n=l();return await Te(),n.asset.setCode(JSON.stringify(a,null,2)),n.asset.meta.webextEntry=!0,n.getAssets()}});0&&(module.exports={});
